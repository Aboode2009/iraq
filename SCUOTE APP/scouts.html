<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨ÙŠØª Ø§Ù„ÙƒØ´Ø§ÙØ© Ø§Ù„Ø¹Ø±Ø§Ù‚ÙŠ - Ù‚ÙŠØ§Ø¯Ø©ØŒ ØªØ±Ø§Ø«ØŒ Ù…Ø³ØªÙ‚Ø¨Ù„</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ÙƒÙ„ Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ */
        
        /* Ø£Ù†Ù…Ø§Ø· Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ */
        .site-management {
            background: var(--black-light);
            padding: 2rem;
            border-radius: var(--border-radius-lg);
            margin-bottom: 2rem;
        }

        .site-logo-preview {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            margin: 1.5rem 0;
            padding: 2rem;
            background: var(--black);
            border-radius: var(--border-radius);
            border: 2px dashed rgba(255, 107, 53, 0.3);
        }

        .current-logo {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .logo-preview-item {
            text-align: center;
            padding: 1rem;
        }

        .logo-preview-item h4 {
            margin-bottom: 0.5rem;
            color: var(--white);
        }

        .favicon-preview {
            width: 32px;
            height: 32px;
            background: var(--gradient-primary);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            color: var(--white);
            font-weight: 800;
            margin: 0 auto;
        }

        .favicon-preview img {
            width: 100%;
            height: 100%;
            border-radius: 8px;
            object-fit: cover;
        }

        .header-logo-preview {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-logo-icon {
            width: 50px;
            height: 50px;
            background: var(--gradient-primary);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1.5rem;
            font-weight: 800;
        }

        .header-logo-icon img {
            width: 100%;
            height: 100%;
            border-radius: 12px;
            object-fit: cover;
        }

        .header-logo-text h1 {
            font-size: 1.2rem;
            font-weight: 800;
            background: linear-gradient(45deg, var(--white), var(--orange-lighter));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1.2;
        }

        .header-logo-text span {
            font-size: 0.8rem;
            color: var(--primary-orange);
            font-weight: 600;
        }
    </style>
</head>
<body>
    <!-- ÙƒÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø³Ø§Ø¨Ù‚ ÙŠØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡Ùˆ -->
    
    <!-- Ù†Ø¶ÙŠÙ Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ -->
    <!-- Ø¯Ø§Ø®Ù„ ØµÙØ­Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ØŒ Ø¨Ø¹Ø¯ Ù‚Ø³Ù… Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø§Ù„Ø¹Ø§Ù…Ø© -->
    <div class="site-management" id="siteManagement" style="display: none;">
        <div class="page-header">
            <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹</h2>
            <p>ØªØºÙŠÙŠØ± Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ§Ù„ÙØ§ÙÙŠÙƒÙˆÙ† (Ø®Ø§Øµ Ø¨Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ ÙÙ‚Ø·)</p>
        </div>
        
        <div class="profile-card">
            <!-- Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø´Ø¹Ø§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ -->
            <div class="site-logo-preview">
                <h3>Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h3>
                <div class="current-logo">
                    <div class="logo-preview-item">
                        <h4>Ø§Ù„ÙØ§ÙÙŠÙƒÙˆÙ†</h4>
                        <div class="favicon-preview" id="currentFaviconPreview">
                            <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                        </div>
                        <small>32x32 Ø¨ÙƒØ³Ù„</small>
                    </div>
                    <div class="logo-preview-item">
                        <h4>Ø´Ø¹Ø§Ø± Ø§Ù„Ù‡ÙŠØ¯Ø±</h4>
                        <div class="header-logo-preview">
                            <div class="header-logo-icon" id="currentHeaderLogoPreview">
                                <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                            </div>
                            <div class="header-logo-text">
                                <h1>Ø¨ÙŠØª Ø§Ù„ÙƒØ´Ø§ÙØ©</h1>
                                <span>Ø§Ù„Ø¹Ø±Ø§Ù‚ÙŠ</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ù†Ù…ÙˆØ°Ø¬ ØªØºÙŠÙŠØ± Ø§Ù„Ø´Ø¹Ø§Ø± -->
            <form id="siteLogoForm">
                <div class="form-group">
                    <label>ØªØºÙŠÙŠØ± Ø§Ù„ÙØ§ÙÙŠÙƒÙˆÙ†</label>
                    <div class="file-input">
                        <div class="file-input-label" id="faviconInputLabel">
                            <i class="fas fa-image"></i>
                            <span>Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ø§Ù„ÙØ§ÙÙŠÙƒÙˆÙ†</span>
                        </div>
                        <input type="file" id="faviconFile" accept="image/*">
                        <div class="file-name" id="faviconFileName">PNG, JPG, SVG - 32x32 Ø¨ÙƒØ³Ù„</div>
                    </div>
                    <div class="avatar-preview" id="faviconPreview" style="width: 80px; height: 80px;">
                        <span>ğŸ–¼ï¸</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>ØªØºÙŠÙŠØ± Ø´Ø¹Ø§Ø± Ø§Ù„Ù‡ÙŠØ¯Ø±</label>
                    <div class="file-input">
                        <div class="file-input-label" id="headerLogoInputLabel">
                            <i class="fas fa-image"></i>
                            <span>Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ø§Ù„Ø´Ø¹Ø§Ø±</span>
                        </div>
                        <input type="file" id="headerLogoFile" accept="image/*">
                        <div class="file-name" id="headerLogoFileName">PNG, JPG - 50x50 Ø¨ÙƒØ³Ù„</div>
                    </div>
                    <div class="avatar-preview" id="headerLogoPreview" style="width: 100px; height: 100px;">
                        <span>ğŸ•ï¸</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>Ù†Øµ Ø§Ù„Ø´Ø¹Ø§Ø± Ø§Ù„Ø¨Ø¯ÙŠÙ„</label>
                    <input type="text" id="logoText" placeholder="Ø¨ÙŠØª Ø§Ù„ÙƒØ´Ø§ÙØ© Ø§Ù„Ø¹Ø±Ø§Ù‚ÙŠ">
                </div>

                <button type="submit" class="btn btn-primary btn-block">
                    <i class="fas fa-save"></i>
                    Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
                </button>
            </form>
        </div>
    </div>

    <!-- Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ -->

    <!-- Ù†Ø¶ÙŠÙ Ù†Ù…ÙˆØ°Ø¬ ØªØ£ÙƒÙŠØ¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø´Ø¹Ø§Ø± -->
    <div id="confirmLogoChangeModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>ØªØ£ÙƒÙŠØ¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø´Ø¹Ø§Ø±</h2>
            <p>Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØºÙŠÙŠØ± Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹ØŸ Ù‡Ø°Ø§ Ø§Ù„ØªØºÙŠÙŠØ± Ø³ÙŠØ¸Ù‡Ø± Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†.</p>
            <div class="form-actions">
                <button class="btn btn-primary" onclick="app.confirmLogoChange()">Ù†Ø¹Ù…ØŒ ØªØºÙŠÙŠØ±</button>
                <button class="btn btn-outline" onclick="app.hideModal('confirmLogoChangeModal')">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <script>
        // ÙÙŠ ÙƒÙ„Ø§Ø³ ScoutsDatabase Ù†Ø¶ÙŠÙ Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø¹Ø§Ø±
        class ScoutsDatabase {
            // ... Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ

            // Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹
            getSiteSettings() {
                return JSON.parse(localStorage.getItem('scouts_site_settings') || '{}');
            }

            updateSiteSettings(settings) {
                const currentSettings = this.getSiteSettings();
                const updatedSettings = { ...currentSettings, ...settings };
                localStorage.setItem('scouts_site_settings', JSON.stringify(updatedSettings));
                return updatedSettings;
            }

            getFavicon() {
                const settings = this.getSiteSettings();
                return settings.favicon || null;
            }

            getHeaderLogo() {
                const settings = this.getSiteSettings();
                return settings.headerLogo || null;
            }

            getLogoText() {
                const settings = this.getSiteSettings();
                return settings.logoText || 'Ø¨ÙŠØª Ø§Ù„ÙƒØ´Ø§ÙØ© Ø§Ù„Ø¹Ø±Ø§Ù‚ÙŠ';
            }

            storeFavicon(file) {
                return new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const settings = JSON.parse(localStorage.getItem('scouts_site_settings') || '{}');
                        settings.favicon = e.target.result;
                        localStorage.setItem('scouts_site_settings', JSON.stringify(settings));
                        resolve(settings.favicon);
                    };
                    reader.readAsDataURL(file);
                });
            }

            storeHeaderLogo(file) {
                return new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const settings = JSON.parse(localStorage.getItem('scouts_site_settings') || '{}');
                        settings.headerLogo = e.target.result;
                        localStorage.setItem('scouts_site_settings', JSON.stringify(settings));
                        resolve(settings.headerLogo);
                    };
                    reader.readAsDataURL(file);
                });
            }
        }

        // ÙÙŠ ÙƒÙ„Ø§Ø³ ScoutsApp Ù†Ø¶ÙŠÙ Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø¹Ø§Ø±
        class ScoutsApp {
            constructor() {
                this.db = new ScoutsDatabase();
                this.currentUser = null;
                this.currentEvaluatingBadge = null;
                this.pendingLogoChanges = null;
                this.init();
            }

            init() {
                this.checkAuth();
                this.setupEventListeners();
                this.loadHomePage();
                this.setupNavigation();
                this.applySiteSettings(); // ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹
            }

            // ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
            applySiteSettings() {
                const favicon = this.db.getFavicon();
                const headerLogo = this.db.getHeaderLogo();
                const logoText = this.db.getLogoText();

                // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙØ§ÙÙŠÙƒÙˆÙ†
                if (favicon) {
                    this.updateFavicon(favicon);
                }

                // ØªØ·Ø¨ÙŠÙ‚ Ø´Ø¹Ø§Ø± Ø§Ù„Ù‡ÙŠØ¯Ø±
                if (headerLogo) {
                    this.updateHeaderLogo(headerLogo);
                }

                // ØªØ·Ø¨ÙŠÙ‚ Ù†Øµ Ø§Ù„Ø´Ø¹Ø§Ø±
                if (logoText && logoText !== 'Ø¨ÙŠØª Ø§Ù„ÙƒØ´Ø§ÙØ© Ø§Ù„Ø¹Ø±Ø§Ù‚ÙŠ') {
                    this.updateLogoText(logoText);
                }
            }

            updateFavicon(faviconData) {
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙØ§ÙÙŠÙƒÙˆÙ† ÙÙŠ Ø§Ù„Ù€ head
                let favicon = document.querySelector("link[rel*='icon']");
                if (!favicon) {
                    favicon = document.createElement('link');
                    favicon.rel = 'icon';
                    document.head.appendChild(favicon);
                }
                favicon.href = faviconData;

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
                const preview = document.getElementById('currentFaviconPreview');
                if (preview) {
                    preview.innerHTML = `<img src="${faviconData}" alt="ÙØ§ÙÙŠÙƒÙˆÙ† Ø§Ù„Ù…ÙˆÙ‚Ø¹">`;
                }
            }

            updateHeaderLogo(logoData) {
                // ØªØ­Ø¯ÙŠØ« Ø´Ø¹Ø§Ø± Ø§Ù„Ù‡ÙŠØ¯Ø±
                const logoIcons = document.querySelectorAll('.logo-icon, .header-logo-icon');
                logoIcons.forEach(icon => {
                    icon.innerHTML = `<img src="${logoData}" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹">`;
                });

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
                const preview = document.getElementById('currentHeaderLogoPreview');
                if (preview) {
                    preview.innerHTML = `<img src="${logoData}" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹">`;
                }
            }

            updateLogoText(text) {
                // ØªØ­Ø¯ÙŠØ« Ù†ØµÙˆØµ Ø§Ù„Ø´Ø¹Ø§Ø± ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø£Ù†Ø­Ø§Ø¡ Ø§Ù„Ù…ÙˆÙ‚Ø¹
                const logoTexts = document.querySelectorAll('.logo-text h1, .footer-logo-text h3');
                logoTexts.forEach(element => {
                    element.textContent = text;
                });

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
                document.title = text + ' - Ù‚ÙŠØ§Ø¯Ø©ØŒ ØªØ±Ø§Ø«ØŒ Ù…Ø³ØªÙ‚Ø¨Ù„';
            }

            setupEventListeners() {
                // event listeners Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ
                
                // Ø¥Ø¶Ø§ÙØ© event listeners Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹
                document.getElementById('siteLogoForm').addEventListener('submit', (e) => this.handleSiteLogoChange(e));
                document.getElementById('faviconFile').addEventListener('change', (e) => this.handleFaviconSelect(e));
                document.getElementById('headerLogoFile').addEventListener('change', (e) => this.handleHeaderLogoSelect(e));
            }

            loadProfilePage() {
                if (!this.currentUser) {
                    this.showNotification('ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'error');
                    this.showPage('home');
                    return;
                }

                this.loadProfileInfo();
                this.loadProfileStats();
                this.loadProfileDetails();
                
                // ØªØ­Ù…ÙŠÙ„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒØ´Ø§ÙÙŠÙ† Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‚Ø§Ø¦Ø¯Ø§Ù‹
                if (this.db.isUserLeader(this.currentUser)) {
                    this.loadScoutsManagement();
                    this.loadBadgesManagement();
                }

                // ØªØ­Ù…ÙŠÙ„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¤ÙˆÙ„Ø§Ù‹
                if (this.db.isUserAdmin(this.currentUser)) {
                    this.loadSiteManagement();
                }
            }

            loadSiteManagement() {
                const siteManagement = document.getElementById('siteManagement');
                siteManagement.style.display = 'block';
                
                this.loadCurrentLogos();
            }

            loadCurrentLogos() {
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
                const favicon = this.db.getFavicon();
                const headerLogo = this.db.getHeaderLogo();

                const faviconPreview = document.getElementById('currentFaviconPreview');
                const headerLogoPreview = document.getElementById('currentHeaderLogoPreview');

                if (favicon) {
                    faviconPreview.innerHTML = `<img src="${favicon}" alt="ÙØ§ÙÙŠÙƒÙˆÙ† Ø§Ù„Ù…ÙˆÙ‚Ø¹">`;
                } else {
                    faviconPreview.innerHTML = 'Ùƒ';
                }

                if (headerLogo) {
                    headerLogoPreview.innerHTML = `<img src="${headerLogo}" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹">`;
                } else {
                    headerLogoPreview.innerHTML = 'Ùƒ';
                }

                // ØªØ­Ù…ÙŠÙ„ Ù†Øµ Ø§Ù„Ø´Ø¹Ø§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ
                const logoText = this.db.getLogoText();
                document.getElementById('logoText').value = logoText;
            }

            handleFaviconSelect(e) {
                const file = e.target.files[0];
                const fileName = document.getElementById('faviconFileName');
                const preview = document.getElementById('faviconPreview');
                
                if (file) {
                    if (!file.type.startsWith('image/')) {
                        this.showNotification('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù ØµÙˆØ±Ø© ØµØ­ÙŠØ­', 'error');
                        e.target.value = '';
                        fileName.textContent = 'PNG, JPG, SVG - 32x32 Ø¨ÙƒØ³Ù„';
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = function(e) {
                        preview.innerHTML = `<img src="${e.target.result}" alt="Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ÙØ§ÙÙŠÙƒÙˆÙ†">`;
                    };
                    reader.readAsDataURL(file);

                    fileName.textContent = `ğŸ“· ${file.name} (${this.formatFileSize(file.size)})`;
                } else {
                    fileName.textContent = 'PNG, JPG, SVG - 32x32 Ø¨ÙƒØ³Ù„';
                    preview.innerHTML = '<span>ğŸ–¼ï¸</span>';
                }
            }

            handleHeaderLogoSelect(e) {
                const file = e.target.files[0];
                const fileName = document.getElementById('headerLogoFileName');
                const preview = document.getElementById('headerLogoPreview');
                
                if (file) {
                    if (!file.type.startsWith('image/')) {
                        this.showNotification('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù ØµÙˆØ±Ø© ØµØ­ÙŠØ­', 'error');
                        e.target.value = '';
                        fileName.textContent = 'PNG, JPG - 50x50 Ø¨ÙƒØ³Ù„';
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = function(e) {
                        preview.innerHTML = `<img src="${e.target.result}" alt="Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø´Ø¹Ø§Ø±">`;
                    };
                    reader.readAsDataURL(file);

                    fileName.textContent = `ğŸ“· ${file.name} (${this.formatFileSize(file.size)})`;
                } else {
                    fileName.textContent = 'PNG, JPG - 50x50 Ø¨ÙƒØ³Ù„';
                    preview.innerHTML = '<span>ğŸ•ï¸</span>';
                }
            }

            async handleSiteLogoChange(e) {
                e.preventDefault();
                
                if (!this.db.isUserAdmin(this.currentUser)) {
                    this.showNotification('ØºÙŠØ± Ù…ØµØ±Ø­ Ù„Ùƒ Ø¨ØªØºÙŠÙŠØ± Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹', 'error');
                    return;
                }

                const faviconFile = document.getElementById('faviconFile').files[0];
                const headerLogoFile = document.getElementById('headerLogoFile').files[0];
                const logoText = document.getElementById('logoText').value.trim();

                const changes = {};

                if (faviconFile) {
                    changes.favicon = await this.db.storeFavicon(faviconFile);
                }

                if (headerLogoFile) {
                    changes.headerLogo = await this.db.storeHeaderLogo(headerLogoFile);
                }

                if (logoText && logoText !== '') {
                    changes.logoText = logoText;
                }

                if (Object.keys(changes).length === 0) {
                    this.showNotification('Ù„Ù… ØªÙ‚Ù… Ø¨Ø¥Ø¬Ø±Ø§Ø¡ Ø£ÙŠ ØªØºÙŠÙŠØ±Ø§Øª', 'info');
                    return;
                }

                this.pendingLogoChanges = changes;
                this.showModal('confirmLogoChangeModal');
            }

            async confirmLogoChange() {
                if (this.pendingLogoChanges) {
                    // Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    this.db.updateSiteSettings(this.pendingLogoChanges);

                    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙÙˆØ±Ø§Ù‹
                    if (this.pendingLogoChanges.favicon) {
                        this.updateFavicon(this.pendingLogoChanges.favicon);
                    }

                    if (this.pendingLogoChanges.headerLogo) {
                        this.updateHeaderLogo(this.pendingLogoChanges.headerLogo);
                    }

                    if (this.pendingLogoChanges.logoText) {
                        this.updateLogoText(this.pendingLogoChanges.logoText);
                    }

                    this.hideModal('confirmLogoChangeModal');
                    this.showNotification('ØªÙ… ØªØºÙŠÙŠØ± Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                    
                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                    document.getElementById('siteLogoForm').reset();
                    document.getElementById('faviconPreview').innerHTML = '<span>ğŸ–¼ï¸</span>';
                    document.getElementById('headerLogoPreview').innerHTML = '<span>ğŸ•ï¸</span>';
                    document.getElementById('faviconFileName').textContent = 'PNG, JPG, SVG - 32x32 Ø¨ÙƒØ³Ù„';
                    document.getElementById('headerLogoFileName').textContent = 'PNG, JPG - 50x50 Ø¨ÙƒØ³Ù„';

                    this.pendingLogoChanges = null;
                }
            }

            // ... Ø¨Ù‚ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ù„ ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ
        }

        // ... Ø¨Ù‚ÙŠØ© Ø§Ù„ÙƒÙˆØ¯ ÙŠØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡Ùˆ
    </script>
</body>
</html>